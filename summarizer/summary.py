from ollama import Client

client = Client(host='http://localhost:11434')

PROMPT = """
–¢—ã –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
–í–æ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≤—Å—Ç—Ä–µ—á–∏:

{transcript_text}

–°–¥–µ–ª–∞–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
- summary –≤—Å—Ç—Ä–µ—á–∏ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- –≤—ã–¥–µ–ª–∏ –≤—Å–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è
- –≤—ã–ø–∏—à–∏ –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: [–æ–ø–∏—Å–∞–Ω–∏–µ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π, —Å—Ä–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)]

–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç —è–≤–Ω—ã—Ö –∑–∞–¥–∞—á –∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π, —á–µ—Å—Ç–Ω–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ –∏—Ö –Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö"). –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ.
–û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ù–∏–∫–∞–∫–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, think-–±–ª–æ–∫–æ–≤, markdown –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –Ω–µ –ø–∏—Å–∞—Ç—å.

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
{{
  "summary": "...",
  "agreements": ["..."],
  "tasks": [
    {{"task": "...", "responsible": "...", "deadline": "..."}},
    ...
  ]
}}
"""


def analyze_transcript_qwen3(transcript_text):
    print("‚è≥ [Qwen3] –ù–∞—á–∏–Ω–∞—é –∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞...")
    print(f"üî∏ –î–ª–∏–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞: {len(transcript_text)} —Å–∏–º–≤–æ–ª–æ–≤")
    print(f"üî∏ –ü—Ä–æ–º–ø—Ç –¥–ª—è LLM (–Ω–∞—á–∞–ª–æ): {PROMPT[:200]}...")

    prompt_to_send = PROMPT.format(transcript_text=transcript_text)
    print(f"üîπ –§—Ä–∞–≥–º–µ–Ω—Ç prompt –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):\n{prompt_to_send[:500]}...")

    try:
        response = client.generate(
            model='qwen3',
            prompt=prompt_to_send,
            stream=False
        )
    except Exception as e:
        print(f"‚ùå [Qwen3] –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ LLM: {e}")
        raise

    print("‚úÖ [Qwen3] –ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ –æ—Ç–≤–µ—Ç. –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞:", len(response['response']))
    print("üîπ –ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):\n", response['response'][:500], "...")

    return response['response']
